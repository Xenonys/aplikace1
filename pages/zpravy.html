<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sen:wght@400..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/styles.css">
    <link rel="stylesheet" href="../assets/reset.css">
    <link rel="stylesheet" href="../assets/responsivita.css">
    <script src="../assets/popup.js"></script>
    <script src="../assets/signout.js"></script>
    <script src="../assets/language.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body class="telo">
    <div class="container">
    <div class="sidebar1"> 
        <a href="../index.html" class="logo">
            <svg width="80" height="81" viewBox="0 0 80 81" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path id="Black outline logo" d="M12.9167 41.7045L2.5 50.2273L23.3333 67.2727M12.9167 41.7045L2.5 33.1818L40 2.5L77.5 33.1818L67.0833 41.7045M12.9167 41.7045L23.3333 50.2273V67.2727M23.3333 67.2727L35.8333 77.5V50.2273L15 33.1818L40 12.7273L65 33.1818L44.1667 50.2273V77.5L56.6667 67.2727M67.0833 41.7045L77.5 50.2273L56.6667 67.2727M67.0833 41.7045L56.6667 50.2273V67.2727M40 33.1818L33.75 38.2955L27.5 33.1818L40 22.9545L52.5 33.1818L46.25 38.2955L40 33.1818Z" stroke="white" stroke-width="3"/>
            </svg>
        </a>
        <a href="../index.html" class="item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="home-04"><path id="Icon" d="M9 21V14.1528C9 13.5226 9.53726 13.0116 10.2 13.0116H13.8C14.4627 13.0116 15 13.5226 15 14.1528V21M11.3046 3.21117L3.50457 8.48603C3.18802 8.7001 3 9.04665 3 9.41605V19.2882C3 20.2336 3.80589 21 4.8 21H19.2C20.1941 21 21 20.2336 21 19.2882V9.41605C21 9.04665 20.812 8.70011 20.4954 8.48603L12.6954 3.21117C12.2791 2.92961 11.7209 2.92961 11.3046 3.21117Z" stroke="white" stroke-width="2" stroke-linecap="round"/></g></svg>
            <div class="title">Domů</div>
        </a>
        <a href="./profil.html" class="frame">
            <div class="item">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="user-profile-03"><path id="Icon" d="M3.23773 19.5C4.56314 17.2892 7.46801 15.7762 12 15.7762C16.532 15.7762 19.4369 17.2892 20.7623 19.5M15.6 8.1C15.6 10.0882 13.9882 11.7 12 11.7C10.0118 11.7 8.40001 10.0882 8.40001 8.1C8.40001 6.11177 10.0118 4.5 12 4.5C13.9882 4.5 15.6 6.11177 15.6 8.1Z" stroke="white" stroke-width="2" stroke-linecap="round"/></g></svg>
                <div class="title">Profil</div>
            </div>
        </a>
        <a href="./zpravy.html" class="item1">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="message-chat-01"><path id="Icon" d="M4.99983 11C4.99983 6.58172 8.58125 3 12.9992 3C17.4171 3 20.9985 6.58172 20.9985 11C20.9985 12.15 20.7558 13.2434 20.319 14.2316L21 18.9992L16.9146 17.9778C15.7572 18.6287 14.4215 19 12.9992 19M3.00095 16C3.00095 16.7188 3.15258 17.4021 3.4256 18.0198L3 20.9995L5.55315 20.3611C6.27643 20.768 7.11115 21 8.00005 21C10.761 21 12.9992 18.7614 12.9992 16C12.9992 13.2386 10.761 11 8.00005 11C5.23912 11 3.00095 13.2386 3.00095 16Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></g></svg>
            <div class="title">Zprávy</div>
        </a>
        <a href="./smeny.html" class="item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="calendar-02"><path id="Icon" d="M7.75 17.2202V17.1428M12.25 17.2202V17.1428M12.25 13.0286V12.9512M16.25 13.0286V12.9512M4.75 8.91425H18.75M6.55952 3V4.54304M16.75 3V4.54285M16.75 4.54285H6.75C5.09315 4.54285 3.75 5.92436 3.75 7.62855V17.9143C3.75 19.6185 5.09315 21 6.75 21H16.75C18.4069 21 19.75 19.6185 19.75 17.9143L19.75 7.62855C19.75 5.92436 18.4069 4.54285 16.75 4.54285Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></g></svg>
            <div class="title">Směny</div>
        </a>
        <div class="item2 sett">
            <button onclick="openPopup()" class="signout">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="settings"><g id="Icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.6763 4.31627C13.2488 2.56124 10.7512 2.56124 10.3237 4.31627C10.2599 4.57999 10.1347 4.82492 9.95831 5.03112C9.78194 5.23732 9.55938 5.39897 9.30874 5.50291C9.0581 5.60684 8.78646 5.65014 8.51592 5.62927C8.24538 5.60839 7.9836 5.52394 7.75187 5.38279C6.20832 4.44227 4.44201 6.20855 5.38254 7.75207C5.99006 8.74884 5.45117 10.0494 4.31713 10.325C2.56096 10.7514 2.56096 13.25 4.31713 13.6753C4.58093 13.7392 4.8259 13.8645 5.03211 14.041C5.23831 14.2175 5.39991 14.4402 5.50375 14.691C5.6076 14.9418 5.65074 15.2135 5.62968 15.4841C5.60862 15.7547 5.52394 16.0165 5.38254 16.2482C4.44201 17.7917 6.20832 19.558 7.75187 18.6175C7.98356 18.4761 8.24536 18.3914 8.51597 18.3704C8.78658 18.3493 9.05834 18.3924 9.30912 18.4963C9.5599 18.6001 9.7826 18.7617 9.95911 18.9679C10.1356 19.1741 10.2609 19.4191 10.3248 19.6829C10.7512 21.439 13.2499 21.439 13.6752 19.6829C13.7393 19.4192 13.8647 19.1744 14.0413 18.9684C14.2178 18.7623 14.4405 18.6008 14.6912 18.497C14.9419 18.3932 15.2135 18.35 15.4841 18.3709C15.7546 18.3919 16.0164 18.4764 16.2481 18.6175C17.7917 19.558 19.558 17.7917 18.6175 16.2482C18.4763 16.0165 18.3918 15.7547 18.3709 15.4842C18.35 15.2136 18.3932 14.942 18.497 14.6913C18.6008 14.4406 18.7623 14.2179 18.9683 14.0414C19.1744 13.8648 19.4192 13.7394 19.6829 13.6753C21.439 13.2489 21.439 10.7502 19.6829 10.325C19.4191 10.2611 19.1741 10.1358 18.9679 9.95928C18.7617 9.78278 18.6001 9.56007 18.4962 9.3093C18.3924 9.05853 18.3493 8.78677 18.3703 8.51617C18.3914 8.24556 18.4761 7.98376 18.6175 7.75207C19.558 6.20855 17.7917 4.44227 16.2481 5.38279C16.0164 5.52418 15.7546 5.60886 15.484 5.62992C15.2134 5.65098 14.9417 5.60784 14.6909 5.504C14.4401 5.40016 14.2174 5.23856 14.0409 5.03236C13.8644 4.82616 13.7391 4.58119 13.6752 4.3174L13.6763 4.31627Z" stroke="white" stroke-width="2" stroke-linecap="round"/><path d="M14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12Z" stroke="white" stroke-width="2" stroke-linecap="round"/></g></g></svg>
            </button>
            <button onclick="openSignOutPopup()" class="signout">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 3H6a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h4M16 17l5-5-5-5M19.8 12H9"/></svg>
            </button>
        </div>  
    </div>
    <div class="sidebarz">
      <h2 style="padding: 15px; margin: 0; color: white;">Chaty</h2>
      <div id="sidebarChatList">
          <!-- Chat contacts will be populated here by JavaScript -->
      </div>
      
      <!-- Keep your existing contacts as a fallback -->
      <span id="fallback-contacts" style="display: none;">
          <div class="frame">
              <div class="vi-wrapper">
                  <svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <g id="image">
                      <rect width="100" height="100" rx="50" fill="#D9D9D9" fill-opacity="0.5"/>
                      <path id="Icon" d="M29.5625 36.5309V30.559M72.4375 36.5309V30.559M33.9146 69.3759C40.8979 74.7867 56.5578 74.7867 66.3159 69.3759M47.9375 54.4465L49.206 53.2097C50.3547 52.0897 51 50.5707 51 48.9869V33.5449" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </g>
                      </svg>
                      <span>Pepa</span> 
              </div>
          </div>
      </span>
  </div>
    <div class="mainz">
        <div id="chatBox">
          <div id="chat-header">
            <h2 id="currentChatName">Vybraný chat</h2>
          </div>
          <ul id="messages"></ul>
          <div id="typing-indicator" class="typing-indicator"></div>
          <div class="message-input">
            <input type="text" id="message" placeholder="Napište zprávu...">
            <button id="sendMessageBtn" onclick="sendMessage()">Odeslat</button>
          </div>
        </div>
      </div>
    <div class="overlay" id="popupOverlay">
        <div class="popup" id="popup">
            <button class="close-btn" onclick="closePopup()">✖</button>
            <h2  class="jazyk">Settings</h2>
            <div class="setting-option">
                <span class="jazyk">Notifikace</span>
                <div class="toggle" onclick="toggleOption(this)"></div>
            </div>
            <div class="setting-option">
                <span class="jazyk">Světlý mod</span>
                <div class="toggle" onclick="toggleOption(this)"></div>
            </div>
            <div class="setting-option">
                <span class="jazyk">Jazyk</span>
                <select id="languageSelect" onchange="changeLanguage(this)">
                    <option value="cz">Čeština</option>
                    <option value="en">English</option>                   
                    <option value="es">Español</option>
                    <option value="de">Deutsch</option>
                </select>
            </div>
        </div>
    </div>
    <div class="overlay" id="signoutOverlay">
        <div class="popup" id="signoutPopup">
            <h2 class="jazyk">Chcete se opravdu odhlásit?</h2>
            <div class="popup-buttons">
                <button class="confirm-btn jazyk" id="logoutButton" onclick="confirmSignOut()">Ano, odhlásit se</button>
                <button class="cancel-btn jazyk" onclick="closeSignOutPopup()">Zrušit</button>
            </div>
        </div>
    </div>
</div>
    <script>
        
        document.getElementById("logoutButton").addEventListener("click", function() {
            localStorage.removeItem("isLoggedIn");
            window.location.href = "./login.html";
        });
        document.addEventListener("DOMContentLoaded", function () {
        if (localStorage.getItem("isLoggedIn") !== "true") {
            window.location.href = "./login.html";
        }
        });
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  
    <script src="../JavaScript/chat.js"></script>
    <script src="../renderer.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Get user data
        const userData = JSON.parse(localStorage.getItem('userData') || '{}');
        const currentUsername = userData.username || 'Guest';
        
        console.log("Current user:", currentUsername);
        console.log("User data:", userData);
        
        // DOM Elements
        const messagesContainer = document.getElementById('messages');
        const messageInput = document.getElementById('message');
        const sendButton = document.getElementById('sendMessageBtn');
        const currentChatName = document.getElementById('currentChatName');
        const typingIndicator = document.getElementById('typing-indicator');
        const sidebarChatList = document.getElementById('sidebarChatList');

        
        // Chat state
        let activeChat = null;
        let chats = [];
        let typingTimeout;
        
        // Initialize socket connection
        let socket;
        try {
          socket = io('http://localhost:5000', {
            query: {
              username: currentUsername
            }
          });
          
          console.log("Socket connection initialized");
          
          // Socket events
          socket.on('connect', () => {
            console.log('Connected to chat server');
            // Load chat history
            socket.emit('get chats', currentUsername);
          });
          
          socket.on('chat history', (chatData) => {
            console.log('Received chat history:', chatData);
            chats = chatData;
            updateSidebar();
            
            // If there are chats, select the first one
            if (chats.length > 0) {
              selectChat(chats[0].id);
            }
          });
          
          socket.on('new message', (message) => {
            console.log('New message received:', message);
            
            // Update chat preview in the list
            updateChatPreview(message.chatId, message);
            
            // If this is for the active chat, add it to the messages
            if (message.chatId === activeChat) {
              addMessageToChat(message);
              scrollToBottom();
            } else {
              // Highlight the chat with new message
              highlightChat(message.chatId);
            }
          });
          
          socket.on('typing', (data) => {
            if (data.chatId === activeChat && data.username !== currentUsername) {
              typingIndicator.textContent = `${data.username} píše...`;
            }
          });
          
          socket.on('stop typing', (data) => {
            if (data.chatId === activeChat) {
              typingIndicator.textContent = '';
            }
          });
          
          socket.on('user profile', (profile) => {
            updateUserProfile(profile);
          });
          
          socket.on('new chat', (chat) => {
            // Check if we already have this chat
            const existingChat = chats.find(c => c.id === chat.id);
            if (!existingChat) {
              chats.push(chat);
              updateSidebar();
            }
          });
          
          socket.on('disconnect', () => {
            console.log('Disconnected from chat server');
          });
          
          socket.on('connect_error', (error) => {
            console.error('Socket connection error:', error);
            setTimeout(() => {
              loadMockData();
            }, 1000);
          });
        } catch (error) {
          console.error("Socket initialization error:", error);
          // If socket.io fails, load mock data
          setTimeout(() => {
            loadMockData();
          }, 1000);
        }
        
        // Event listeners
        if (messageInput) {
          messageInput.addEventListener('keypress', function(e) {
            // Send message on Enter key
            if (e.key === 'Enter') {
              sendMessage();
            }
            
            if (socket && socket.connected) {
              // Emit typing event
              socket.emit('typing', {
                username: currentUsername,
                chatId: activeChat
              });
              
              // Clear previous timeout
              clearTimeout(typingTimeout);
              
              // Set new timeout
              typingTimeout = setTimeout(() => {
                socket.emit('stop typing', {
                  username: currentUsername,
                  chatId: activeChat
                });
              }, 1000);
            }
          });
        }
        
        if (sendButton) {
          sendButton.addEventListener('click', sendMessage);
        }
     
        // Initialize the app
        updateUserProfile(userData);
        
        // Functions
        function updateSidebar() {
          if (!sidebarChatList) return;
          console.log("Updating sidebar with chats:", chats);
          
          // Clear existing sidebar chat list
          sidebarChatList.innerHTML = '';
          
          // Add chats to sidebar
          chats.forEach(chat => {
            const chatItem = document.createElement('span');
            
            // Determine chat name (for direct chats, use the other user's name)
            const chatName = chat.isGroup ? 
              chat.name : 
              chat.participants.find(p => p !== currentUsername);
            
            chatItem.innerHTML = `
              <div class="frame" data-chat-id="${chat.id}">
                <div class="img-wrapper">
                  <img src="${chat.avatar || '../assets/placeholder.jpg'}" 
                       alt="${chatName}" 
                       width="70" height="70" 
                       style="border-radius: 50%; object-fit: cover; border: 5px solid #4950d4;">
                  <span>${chatName}</span>
                </div>
              </div>
            `;
            
            // Add click event
            chatItem.querySelector('.frame').addEventListener('click', () => {
              selectChat(chat.id);
            });
            
            sidebarChatList.appendChild(chatItem);
          });
          
          // Show or hide fallback contacts
          const fallbackContacts = document.getElementById('fallback-contacts');
          if (fallbackContacts) {
            fallbackContacts.style.display = chats.length > 0 ? 'none' : 'block';
          }
        }
        
        function selectChat(chatId) {
          console.log("Selecting chat:", chatId);
          
          // Remove active class from sidebar items
          document.querySelectorAll('.sidebarz .frame').forEach(item => {
            item.style.backgroundColor = '';
          });
          
          // Highlight selected chat in sidebar
          const sidebarChatElement = document.querySelector(`.sidebarz .frame[data-chat-id="${chatId}"]`);
          if (sidebarChatElement) {
            sidebarChatElement.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
          }
          
          // Set active chat
          activeChat = chatId;
          
          // Get chat data
          const chat = chats.find(c => c.id === chatId);
          if (!chat) return;
          
          // Update chat header
          const chatName = chat.isGroup ? 
            chat.name : 
            chat.participants.find(p => p !== currentUsername);
          if (currentChatName) {
            currentChatName.textContent = chatName;
          }
          
          // Get user profile for direct chats
          if (!chat.isGroup && socket && socket.connected) {
            socket.emit('get user profile', chat.participants.find(p => p !== currentUsername));
          }
          
          // Clear messages
          if (messagesContainer) {
            messagesContainer.innerHTML = '';
            
            // Load messages
            chat.messages.forEach(message => {
              addMessageToChat(message);
            });
            
            // Scroll to bottom
            scrollToBottom();
          }
        }
        
        function sendMessage() {
          const messageText = messageInput.value.trim();
          
          if (messageText && activeChat) {
            // Clear input
            messageInput.value = '';
            
            // Create message object
            const messageId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            const message = {
              id: messageId,  // Add unique ID
              chatId: activeChat,
              sender: currentUsername,
              text: messageText,
              timestamp: new Date().toISOString()
            };
            
            console.log("Sending message:", message);
            
            // Send to server if connected
            if (socket && socket.connected) {
      socket.emit('new message', message);
      
          // For connected mode, DON'T add message directly to UI
          // Let the server echo it back through the 'new message' event
          // This prevents duplicate messages
        } else {
          // For offline mode, add directly since there's no server echo
          addMessageToChat(message);
          updateChatPreview(activeChat, message);
          scrollToBottom();
        }
            
            // Stop typing indicator
            if (socket && socket.connected) {
              socket.emit('stop typing', {
                username: currentUsername,
                chatId: activeChat
              });
            }
          }
        }
        
        function addMessageToChat(message) {
          if (!messagesContainer) return;
          
          const li = document.createElement('li');
          const isOwnMessage = message.sender === currentUsername;
          
          li.className = `message ${isOwnMessage ? 'own' : 'other'}`;
          
          // Format timestamp
          const timestamp = new Date(message.timestamp);
          const formattedTime = timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          
          li.innerHTML = `
            ${!isOwnMessage ? `<div class="message-sender">${message.sender}</div>` : ''}
            <div class="message-text">${message.text}</div>
            <span class="message-time">${formattedTime}</span>
          `;
          
          messagesContainer.appendChild(li);
        }
        
        function scrollToBottom() {
          if (messagesContainer) {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }
        }
        
        function updateChatPreview(chatId, message) {
          const chat = chats.find(c => c.id === chatId);
          if (!chat) return;
          
          // Add message to chat
          chat.messages.push(message);
        }
        
        function highlightChat(chatId) {
          const chatElement = document.querySelector(`.sidebarz .frame[data-chat-id="${chatId}"]`);
          if (chatElement) {
            chatElement.style.backgroundColor = 'rgba(100, 100, 255, 0.3)';
            setTimeout(() => {
              if (chatId !== activeChat) {
                chatElement.style.backgroundColor = '';
              } else {
                chatElement.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
              }
            }, 2000);
          }
        }
        
        function updateUserProfile(userData) {
          if (!userData) return;
          
          const profileImage = document.getElementById('profileImage');
          const profileName = document.getElementById('profileName');
          const profilePosition = document.getElementById('profilePosition');
          const profileBio = document.getElementById('profileBio');
          const profileEmail = document.getElementById('profileEmail');
          const profilePhone = document.getElementById('profilePhone');
          const profileAddress = document.getElementById('profileAddress');
          
          if (profileImage && userData.profile_picture) {
            profileImage.src = userData.profile_picture;
          }
          
          if (profileName) {
            profileName.textContent = userData.fullName || userData.username || 'Uživatel';
          }
          
          if (profilePosition) {
            profilePosition.textContent = userData.position || 'Pozice není určena';
          }
          
          if (profileBio) {
            profileBio.textContent = userData.bio || 'Žádný popisek';
          }
          
          if (profileEmail) {
            profileEmail.textContent = userData.email || 'email@email.com';
          }
          
          if (profilePhone) {
            profilePhone.textContent = userData.phone || '+420 123 456 789';
          }
          
          if (profileAddress) {
            profileAddress.textContent = userData.address || 'Adresa není určena';
          }
        }
        
        function openNewChatDialog() {
          // Simple prompt for demo purposes
          const recipient = prompt("Zadejte uživatelské jméno příjemce:");
          
          if (recipient && recipient !== currentUsername) {
            // Check if chat already exists
            const existingChat = chats.find(chat => 
              !chat.isGroup && 
              chat.participants.includes(currentUsername) && 
              chat.participants.includes(recipient)
            );
            
            if (existingChat) {
              // If chat exists, select it
              selectChat(existingChat.id);
            } else {
              // Create new chat
              createNewChat(recipient);
            }
          }
        }
        
        function createNewChat(recipient) {
          // Generate unique ID
          const chatId = 'chat-' + Date.now();
          
          // Create new chat object
          const newChat = {
            id: chatId,
            isGroup: false,
            participants: [currentUsername, recipient],
            avatar: 'https://i.pravatar.cc/150?img=' + Math.floor(Math.random() * 10),
            messages: []
          };
          
          console.log("Creating new chat:", newChat);
          
          // Add to chats array
          chats.push(newChat);
          
          // Add to server (in a real app)
          if (socket && socket.connected) {
            socket.emit('create chat', newChat);
          }
          
          // Update UI
          updateSidebar();
          
          // Select the new chat
          selectChat(chatId);
        }
        
        // Mock data for testing without a server
        function loadMockData() {
          console.log("Loading mock chat data");
          
          const mockChats = [
            {
              id: 'chat1',
              name: 'Team Chat',
              isGroup: true,
              participants: [currentUsername, 'Pepa', 'Vasa', 'Franta', 'admin', '1234'],
              avatar: 'https://i.pravatar.cc/150?img=1',
              messages: [
                {
                  chatId: 'chat1',
                  sender: 'Pepa',
                  text: 'Ahoj týme, jak se máte?',
                  timestamp: '2023-09-10T08:30:00.000Z'
                },
                {
                  chatId: 'chat1',
                  sender: 'Vasa',
                  text: 'Všechno v pohodě, pracuji na nových funkcích',
                  timestamp: '2023-09-10T08:32:00.000Z'
                },
                {
                  chatId: 'chat1',
                  sender: currentUsername,
                  text: 'Ahoj, já taky v pohodě. Chystám se na schůzku.',
                  timestamp: '2023-09-10T08:35:00.000Z'
                }
              ]
            },
            {
              id: 'chat2',
              name: null,
              isGroup: false,
              participants: [currentUsername, 'Pepa'],
              avatar: 'https://i.pravatar.cc/150?img=3',
              messages: [
                {
                  chatId: 'chat2',
                  sender: 'Pepa',
                  text: 'Ahoj, můžeš mi pomoct s tím novým projektem?',
                  timestamp: '2023-09-11T10:15:00.000Z'
                },
                {
                  chatId: 'chat2',
                  sender: currentUsername,
                  text: 'Jasně, co potřebuješ?',
                  timestamp: '2023-09-11T10:18:00.000Z'
                }
              ]
            },
            {
              id: 'chat3',
              name: null,
              isGroup: false,
              participants: [currentUsername, '1234'],
              avatar: 'https://i.pravatar.cc/150?img=7',
              messages: [
                {
                  chatId: 'chat3',
                  sender: '1234',
                  text: 'Ahoj, kdy budeš mít čas na schůzku?',
                  timestamp: '2023-09-12T14:20:00.000Z'
                },
                {
                  chatId: 'chat3',
                  sender: currentUsername,
                  text: 'Zítra v 15:00 by mi vyhovovalo',
                  timestamp: '2023-09-12T14:22:00.000Z'
                },
                {
                  chatId: 'chat3',
                  sender: '1234',
                  text: 'Skvělé, tak se těším!',
                  timestamp: '2023-09-12T14:25:00.000Z'
                }
              ]
            }
          ];
          
          chats = mockChats;
          updateSidebar();
          
          // Select first chat
          if (chats.length > 0) {
            selectChat(chats[0].id);
          }
        }
        
        // If there's no server connection after 3 seconds, load mock data
        setTimeout(() => {
          if (chats.length === 0) {
            console.log('No chats loaded after timeout, loading mock data');
            loadMockData();
          }
        }, 3000);
      });
    </script>
</body>
</html>